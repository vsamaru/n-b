!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(global,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(e,t,n){const o=n(5),i=["fr_FR","en_EN"];e.exports=new class{_is(e,t){const{source:n}=e.message;return n===t}isFacebook(e){return this._is(e,"facebook")||this._is(e,"messenger")}isAlexa(e){return this._is(e,"alexa")}isGactions(e){return this._is(e,"gactions")}isViber(e){return this._is(e,"viber")}isSlack(e){return this._is(e,"slack")}isTelegram(e){return this._is(e,"telegram")}isTwitter(e){return this._is(e,"twitter")}isLine(e){return this._is(e,"line")}isBottender(e){return"bottender"===e.message.agent}isBotBuilder(e){return"botbuilder"===e.message.agent}isBotBuilderFacebook(e){return this.isFacebook(e)&&this.isBotBuilder(e)}isBottenderViber(e){return this.isViber(e)&&this.isBottender(e)}isBottenderFacebook(e){return this.isFacebook(e)&&this.isBottender(e)}isBottenderSlack(e){return this.isSlack(e)&&this.isBottender(e)}isBottenderTelegram(e){return this.isTelegram(e)&&this.isBottender(e)}isBottenderLine(e){return this.isLine(e)&&this.isBottender(e)}isWebSite(e){return"website"===e.message.source}getByLang(e,t,n){const o=t.getLang();if(e&&o){if(e[o])return e[o];if(e[this.defaultLanguage])return e[this.defaultLanguage];{const[t]=Object.keys(e);if(-1!=i.indexOf(t))return e[t]}}return n?e[n]:e}toByLang(e,t){if("string"==typeof e)return e;for(let n in e)e[n]=this.getByLang(e[n],t);return e}async sizeFile(e){const{headers:t}=await o({url:e,method:"GET",resolveWithFullResponse:!0});return t["content-length"]}}},function(e,t){e.exports=require("botbuilder")},function(e,t){e.exports=require("lodash")},function(e,t,n){const o=n(0),i=n(13);e.exports=e=>(o.defaultLanguage=e,{shareFormats:!0,formats:i,functions:{Typing:{$params:["data"],$call({session:e}){o.isWebSite(e)||e.sendTyping()}},profile:{$params:["data","user"],async $call({session:e},t){let n={};if(o.isBottenderFacebook(e)){const t=await e.context.getUserProfile();n={name:t.first_name,fullname:`${t.first_name} ${t.last_name}`,image:t.profile_pic,lang:t.locale,gender:t.gender}}else if(o.isBottenderLine(e)){const t=await e.context.getUserProfile();n={name:t.name,image:t.pictureUrl}}else if(o.isBottenderViber(e)){const t=await e.context.getUserDetails();n={name:t.name,image:t.avatar,lang:t.language,country:t.country}}else if(o.isBottenderTelegram(e)){const{from:t}=e.context.event.inlineQuery();n={name:t.first_name,fullname:`${t.first_name} ${t.last_name}`,lang:t.language_code}}t.setMagicVariable("profile",n)}}}})},function(e,t,n){const o=n(1),i=n(0),{heroCard:s}=n(8);function r(e,t,n,r){const a=s(e,{buttons:n},r);if(i.isWebSite(e))return{text:t,buttons:n};if(i.isGactions(e))return[t,...a.buttons.map(e=>{let t,n;switch(e.type){case"postback":t="Suggestions",n=e.msg||e.title;break;case"url":case"web_url":t="LinkOutSuggestion",n={name:e.title,url:e.url}}return{method:t,params:[n]}})];if(i.isTwitter(e))return{text:t,ctas:a.buttons};const l={attachment:{type:"template",payload:{template_type:"button",text:t,buttons:a.buttons}}};return i.isBotBuilderFacebook(e)?new o.Message(e).sourceEvent({facebook:l}):i.isBottenderFacebook(e)?{method:"sendButtonTemplate",params:[t,a.buttons]}:i.isBottenderTelegram(e)?{method:"sendMessage",params:[t,{reply_markup:JSON.stringify({inline_keyboard:a.buttons})}]}:i.isFacebook(e)?l:i.isBotBuilder(e)?new o.Message(e).text(t).addAttachment(a):t}e.exports={buttons:r,format:(e,[t],{session:n},o)=>r(n,e,t,o)}},function(e,t){e.exports=require("request-promise")},function(e,t,n){const o=n(1),i=n(0),s=n(2),r=n(7),a=n(14);function l(e,t,n){if(!t)return;const r=e=>i.toByLang(e,n);if(i.isWebSite(e))return t.map(r);if(i.isFacebook(e))return t=t.map(e=>s.isString(e)?{content_type:"text",title:e,payload:e}:((e=r(e)).type||(e.type="text"),e.action&&(e.payload="action?"+a.stringify(e.action)),e.payload||(e.payload=e.text),{content_type:e.type,title:e.text,payload:e.payload,image_url:e.image}));if(i.isBotBuilder(e))return t.map(t=>(t=r(t),o.CardAction.imBack(e,t,t)));if(i.isBottenderLine(e))return t.map(e=>s.isString(e)?{type:"action",action:{type:"message",label:e}}:((e=r(e)).type||(e.type="message"),e.action&&(e.payload="action?"+a.stringify(e.action)),{type:"action",action:{type:e.type,label:e.text,text:e.payload}}));if(i.isBottenderTelegram(e))return t.map(e=>s.isString(e)?{text:e}:[{text:(e=r(e)).text}]);if(i.isTwitter(e))return t.map(e=>s.isString(e)?{label:e}:{label:(e=r(e)).text,metadata:e.payload});const l=t.map(e=>(e=r(e),s.isString(e)?e:e.text));return i.isGactions(e)?{method:"Suggestions",params:l}:l}e.exports={quickReplies:l,format(e,[t],{session:n},s){if(t=l(n,[t],s),i.isWebSite(n))return r.formats.quickReplies(e,t);if(i.isGactions(n))return[e,t];if(i.isTwitter(n))return{text:e,quick_reply:{type:"options",options:t}};const a={text:e,quick_replies:t};return i.isBotBuilderFacebook(n)?new o.Message(n).sourceEvent({facebook:a}):i.isBottenderFacebook(n)?{method:"sendText",params:[e,{quick_replies:t}]}:i.isFacebook(n)?a:i.isBottenderLine(n)?{method:"replyText",params:[e,{items:t}]}:i.isBottenderTelegram(n)?{method:"sendMessage",params:[e,{reply_markup:JSON.stringify({keyboard:t,one_time_keyboard:!0})}]}:i.isBotBuilder(n)?new o.Message(n).text(e).suggestedActions(o.SuggestedActions.create(n,t)):`${e} (${t.reduce((e,t)=>e+", "+t)})`}}},function(e,t){e.exports={formats:{quickReplies:(e,[t])=>({text:e,actions:t}),email:e=>({text:e,email:!0}),phone:e=>({text:e,phone:!0}),image:(e,t)=>({text:e,image:t}),video:(e,t)=>({text:e,video:t}),buttons:(e,[t])=>({text:e,buttons:t}),carousel:(e,[t,n])=>({text:e,cards:t,actions:n})},shareFormats:!0}},function(e,t,n){const o=n(1),i=n(2),s=n(0);e.exports={heroCard:function(e,t,n){const r=e=>((e=s.toByLang(e,n)).event||(e.type||e.url?e.type||(e.type="web_url"):e.type="postback"),e);if(t=s.toByLang(t,n),s.isWebSite(e)||s.isGactions(e))return t.buttons&&(t.buttons=t.buttons.map(e=>r(e))),t;if(s.isTwitter(e))return t.buttons&&(t.buttons=t.buttons.map(e=>{switch((e=r(e)).type){case"url":case"web_url":return{type:"web_url",url:e.url,label:e.title};case"share":if(!e.tweet)return void console.warn('Specify "tweet" property to use shared button on twitter platform');let{url:t,text:o,via:i,hashtags:r}=e.tweet;return o&&(o="text="+o),t&&(t="&url="+t),i&&(i="&via="+i),r&&(r="&hashtags="+r.split(",")),{type:"web_url",url:`https://twitter.com/intent/tweet?${t}${i}${o}${r}`,label:e.title||s.getByLang({fr_FR:"Partager",en_EN:"Share"},n,"en_EN")}}})),t;if(s.isBottenderViber(e)){let e="",n=[],o=0;if(t.buttons){const i=t.buttons[0];i.url&&(e=i.url),o=t.buttons.length,n=t.buttons.map(t=>{let n,o;switch((t=r(t)).type){case"url":case"web_url":n="open-url",o=t.title;break;case"postback":n="reply",o=t.msg||t.title}return{Columns:6,Rows:1,ActionType:n,ActionBody:t.url||e,Text:o}})}return i.flatten([{Columns:6,Rows:3-(3==o?1:0),ActionType:"open-url",ActionBody:e,Image:t.image},{Columns:6,Rows:2,ActionType:"open-url",ActionBody:e,Text:`<font color=#323232><b>${t.title}</b></font>\n                <font color=#777777><br>${t.subtitle}</font>`,TextSize:"medium",TextVAlign:"middle",TextHAlign:"left"},...n])}if(s.isBottenderTelegram(e)){const e={};return t.buttons&&(e.buttons=t.buttons.map(e=>{let t={text:(e=r(e)).title,callback_data:e.msg||e.title};switch(e.type){case"url":case"web_url":t.url=e.url}return[t]})),e}if(s.isBottenderLine(e)){const e={thumbnailImageUrl:t.image,title:t.title,text:t.subtitle};return t.buttons&&(e.actions=t.buttons.filter(e=>e).map(e=>{switch((e=r(e)).type){case"url":case"web_url":return{type:"uri",uri:e.url,label:e.title};case"postback":return{type:"postback",label:e.title,data:e.msg||e.title}}})),e}if(s.isFacebook(e)){const e={title:i.truncate(t.title||"(empty)",{length:75}),subtitle:i.truncate(t.subtitle,{length:75}),image_url:t.image};return t.buttons&&(e.buttons=t.buttons.filter(e=>e).map(e=>{switch((e=r(e)).type){case"url":case"web_url":return{type:"web_url",url:e.url,title:e.title};case"share":return{type:"element_share"};case"postback":return{type:"postback",title:e.title,payload:e.msg||e.title};case"webview":return{type:"web_url",url:e.url,title:e.title,webview_height_ratio:e.height||"full",messenger_extensions:!0};case"phone":return{type:"phone_number",title:e.title,payload:e.phone_number};case"account_link":return{type:"account_link",url:e.url};default:return e}})),e}if(s.isBotBuilder(e)){const i=new o.HeroCard(e);return["title","subtitle","text","image","buttons"].forEach(r=>{if(t[r]&&"buttons"===r)return t[r]=t[r].map(t=>(t=s.toByLang(t,n)).url?o.CardAction.openUrl(e,t.url,t.title):o.CardAction.imBack(e,t.msg||t.title,t.title)),void i.buttons(t[r]);t[r]&&"image"===r?i.images([o.CardImage.create(e,t[r])]):t[r]&&i[r](t[r])}),i}return t}}},function(e,t){e.exports=(e,t)=>({type:"Connections.SendRequest",name:e,payload:{InSkillProduct:{productId:t}},token:"correlationToken"})},function(e){e.exports=JSON.parse('[{"hello world":"hello world"}]')},function(e){e.exports=JSON.parse('[{"hello world":"salut le monde"}]')},function(e,t,n){e.exports=n(28)},function(e,t,n){const{format:o}=n(6),i=n(15),s=n(16),r=n(17),{format:a}=n(4),l=n(18),u=n(19),c=n(20),m=n(21),p=n(22),d=n(23),b=n(24),f=n(25);e.exports={quickReplies:o,carousel:i,gif:s,buttons:a,markdown:l,image:r,video:u,contact:c,location:m,signin:p,webview:d,...f,email:b("email"),phone:b("phone")}},function(e,t){e.exports=require("querystring")},function(e,t,n){const o=n(1),i=n(0),{heroCard:s}=n(8),{quickReplies:r}=n(6),a=n(2);e.exports=(e,[t,n],{session:l},u)=>{if(n=r(l,n),!a.isArray(t))return e;if(t=t.map(e=>s(l,e,u)).slice(0,10),i.isWebSite(l))return{text:e,cards:t,actions:n};const c={attachment:{type:"template",payload:{template_type:"generic",elements:t}},quick_replies:n};return i.isBotBuilderFacebook(l)?new o.Message(l).sourceEvent({facebook:c}):i.isGactions(l)?[e,{method:"Carousel",items:[]}]:i.isBottenderViber(l)?{method:"sendCarouselContent",params:[{Type:"rich_media",ButtonsGroupColumns:6,ButtonsGroupRows:7,Buttons:a.flatten(t)}]}:i.isBottenderLine(l)?{method:"replyCarouselTemplate",params:[e,t]}:i.isBottenderFacebook(l)?[e,{method:"sendGenericTemplate",params:[t]}]:i.isFacebook(l)?c:i.isBotBuilder(l)?new o.Message(l).attachmentLayout(o.AttachmentLayout.carousel).suggestedActions(o.SuggestedActions.create(l,n)).attachments(t):e}},function(e,t,n){const o=n(1),i=n(0);e.exports=(e,[t],{session:n})=>i.isWebSite(n)?{text:e,image:image}:i.isBotBuilder(n)?new o.Message(n).attachments([new o.AnimationCard(n).text(e).media([{url:t}])]):e},function(e,t,n){const o=n(1),i=n(0),s=n(2);e.exports=async(e,[t,n,r,a],{session:l})=>{if(r||(r=s.last(t.split("/"))),!n){let e=s.last(r.split("."));e=e.toLowerCase(),["gif","png","jpeg","jpg"].indexOf(e)&&(n="image/"+e)}const u={attachment:{type:"image",payload:{url:t}}};return i.isWebSite(l)?{text:e,image:t}:i.isTwitter(l)?{text:e,attachment:{type:"media"},_data:{url:t,size:await i.sizeFile(t),type:n,category:"dm_image"}}:i.isGactions(l)?[e,{method:"Image",params:[{url:t,alt:e}]}]:i.isAlexa(l)?{type:"image",text:e,image:{smallImageUrl:t,largeImageUrl:t}}:i.isBottenderViber(l)?{method:"sendPicture",params:[{text:e,media:t,thumbnail:a}]}:i.isBottenderTelegram(l)?[e,{method:"sendPhoto",params:[t,{caption:r}]}]:i.isBottenderFacebook(l)?[e,{method:"sendImage",params:[t]}]:i.isBottenderLine(l)?{method:"replyImage",params:[t]}:i.isFacebook(l)&&!i.isBotBuilderFacebook(l)?u:i.isBotBuilder(l)?new o.Message(l).text(e).addAttachment({contentUrl:t,contentType:n,name:r}):e}},function(e,t,n){const o=n(1),i=n(0);e.exports=(e,t,{session:n})=>i.isFacebook(n)&&!i.isBotBuilderFacebook(n)?{text:e}:i.isWebSite(n)?{text:e,markdown:!0}:i.isBotBuilder(n)?new o.Message(n).text(e).textFormat("markdown"):e},function(e,t,n){const o=n(1),i=n(0),s=n(2);n(5);e.exports=async(e,[t,n,r,{thumbnail:a,duration:l,size:u}={}],{session:c},m)=>{if(r||(r=s.last(t.split("/"))),!n){let e=s.last(r.split("."));e=e.toLowerCase(),["mp4"].indexOf(e)&&(n="image/"+e)}if(i.isWebSite(c))return{text:e,video:t};if(i.isBottenderViber(c)){const n=await i.sizeFile(t);return[e,{method:"sendVideo",params:[{media:t,thumbnail:a,duration:l,size:u||n}]}]}return i.isGactions(c)?[e,{method:"BasicCard",params:[{text:r,buttons:{title:i.getByLang({fr_FR:"Voir la vidéo",en_EN:"View video"},m,"en_EN"),url:t}}]}]:i.isBottenderLine(c)?[e,{method:"replyVideo",params:[t,a]}]:i.isBottenderTelegram(c)?{method:"sendVideo",params:[t,{thumb:a,duration:l,caption:e}]}:i.isBottenderFacebook(c)?[{method:"sendText",params:[e]},{method:"sendVideo",params:[t]}]:i.isBottenderLine(c)?{method:"replyImage",params:[t]}:i.isFacebook(c)&&!i.isBotBuilderFacebook(c)?facebook:i.isBotBuilder(c)?new o.Message(c).text(e).addAttachment({contentUrl:t,contentType:n,name:r}):e}},function(e,t,n){n(1);const o=n(0);n(2);e.exports=(e,[t,n],{session:i})=>o.isWebSite(i)?{text:e,contact:{phone:t,name:n}}:o.isBottenderViber(i)?[e,{method:"sendContact",params:[{name:n,phone_number:t}]}]:o.isBottenderTelegram(i)?[e,{method:"sendContact",params:[{first_name:n,phone_number:t}]}]:o.isBottenderFacebook(i)?{method:"sendTemplate",params:{template_type:"button",text:n,buttons:[{type:"phone_number",title:"Call",payload:t}]}}:o.isBottenderLine(i)||o.isBotBuilder(i)?void 0:e},function(e,t,n){n(1);const o=n(0);n(2);e.exports=(e,[t,n,{title:i,address:s}={}],{session:r})=>o.isWebSite(r)?{text:e,location:{latitude:t,longitude:n}}:o.isBottenderViber(r)?[e,{method:"sendLocation",params:[{lat:t,lon:n}]}]:o.isBottenderTelegram(r)?[e,{method:"sendLocation",params:[{latitude:t,longitude:n}]}]:o.isBottenderLine(r)?[e,{method:"replyLocation",params:[{title:i,address:s,latitude:t,longitude:n}]}]:o.isAlexa(r)?{type:"AskForPermissionsConsent",permissions:["read::alexa:device:all:address"]}:o.isBottenderFacebook(r)||o.isBotBuilder(r)?void 0:e},function(e,t,n){n(1);const o=n(0),{buttons:i}=(n(2),n(4));e.exports=(e,t={},{session:n},s)=>o.isGactions(n)?[{method:"SignIn",params:[e]}]:o.isAlexa(n)?{type:"LinkAccount",text:e}:i(n,e,[{type:"account_link",url:t.url}],s)},function(e,t,n){n(1);const o=n(0),{buttons:i}=(n(2),n(4));e.exports=(e,[t={}],{session:n},s)=>{let{url:r,data:a}=t;if(!r.startsWith("http")){const e=process.env.SERVER_URL;r=(e||"")+r}var l;return r+=`?data=${encodeURIComponent((l=JSON.stringify(a||{}),Buffer.from(l).toString("base64")))}&webview=true`,o.isWebSite(n)?{text:e,webview:{url:r,height:t.height}}:i(n,e,[{type:"webview",url:r,title:t.button,height:t.height}],s)}},function(e,t,n){const o=n(1),i=n(7).default,s=n(0);e.exports=function(e){return(t,n,{session:r})=>{if(s.isWebSite(r))return i.formats[e](t);let a;switch(e){case"phone":a="user_phone_number";break;case"email":a="user_email"}const l={text:t,quick_replies:[{content_type:a}]};return s.isBotBuilderFacebook(r)?new o.Message(r).sourceEvent({facebook:l}):s.isBottenderFacebook(r)?{method:"sendText",params:[t,{quick_replies:l.quick_replies}]}:s.isFacebook(r)?l:t}}},function(e,t,n){const o=n(26),i=n(27);e.exports={"Amazon.Purchase.Buy":o,"Amazon.Purchase.Cancel":i}},function(e,t,n){const o=n(0),i=n(9);e.exports=(e,[t],{session:n})=>o.isAlexa(n)?i("Buy",t):e},function(e,t,n){const o=n(0),i=n(9);e.exports=(e,[t],{session:n})=>o.isAlexa(n)?i("Cancel",t):e},function(e,t,n){"use strict";n.r(t);var o=n(3),i=n.n(o),s={code:"@Event('start')\nstart() {\n    > hello world\n}\n\n@Intent('open.webview', [\n    'Open webview'\n])\nopenWebview() {\n    @Format('webview', {\n        url: '/webview/test.html',\n        button: 'View',\n        fbHeight: 'tall',\n        height: 100\n    })\n    > Ok, here is the webview\n}\n",compiled:[{name:"start",params:null,type:"function",instructions:[{output:"hello world",params:null,decorators:[]}],_file:{start:{offset:0,line:1,column:1},end:{offset:47,line:6,column:1}},decorators:[{name:"Event",params:["start"]}]},{name:"openWebview",params:null,type:"function",instructions:[{output:"Ok, here is the webview",params:null,decorators:[{name:"Format",params:["webview",{url:"/webview/test.html",__deepIndex:["url","button","fbHeight","height"],button:"View",fbHeight:"tall",height:100}]}]}],_file:{start:{offset:47,line:6,column:1},end:{offset:280,line:18,column:1}},decorators:[{name:"Intent",params:["open.webview",["Open webview"]]}]}]},r={packages:{en_EN:n(10),fr_FR:n(11)}},a={code:{code:"@Intent('greeting', [\n    'Hey',\n    'Hello',\n    'Good afternoon',\n    'Good morning',\n    'Hi'\n])\nhello() {\n    > Hey !\n}\n",compiled:[{name:"hello",params:null,type:"function",instructions:[{output:"Hey !",params:null,decorators:[]}],_file:{start:{offset:0,line:1,column:1},end:{offset:124,line:11,column:1}},decorators:[{name:"Intent",params:["greeting",["Hey","Hello","Good afternoon","Good morning","Hi"]]}]}]},skills:{formats:i.a}};t.default={code:s,languages:r,skills:{formats:i.a,helloSkill:a}}}]).default}));